# Maintainer: Docura Team <https://github.com/WOF-Softwares/Docura>
pkgname=docura-bin
pkgver=1.0.6
pkgrel=1
pkgdesc="Docura - Modern markdown editor built with Tauri"
arch=('x86_64')
url="https://github.com/WOF-Softwares/Docura"
license=('Apache-2.0')
depends=('gtk3' 'webkit2gtk-4.1')
makedepends=()
provides=('docura')
conflicts=('docura')
options=('!strip' '!emptydirs')
source=("docura_1.0.6_amd64.deb")
noextract=("${source[@]}")
sha256sums=('SKIP')

package() {
  msg2 "Extracting .deb package..."
  cd "${srcdir}"
  
  # Extract .deb (data.tar.* contains the actual files)
  ar x "docura_1.0.6_amd64.deb" || {
    error "Failed to extract .deb archive"
    return 1
  }
  
  # Extract data
  tar -xf data.tar.* -C "${pkgdir}/" || {
    error "Failed to extract data.tar"
    return 1
  }
  
  msg2 "Fixing permissions..."
  # Fix permissions
  find "${pkgdir}" -type d -exec chmod 755 {} \+ 2>/dev/null || true
  find "${pkgdir}/usr/bin" -type f -exec chmod 755 {} \+ 2>/dev/null || true
  find "${pkgdir}/usr/share/applications" -type f -exec chmod 644 {} \+ 2>/dev/null || true
  find "${pkgdir}/usr/share/icons" -type f -exec chmod 644 {} \+ 2>/dev/null || true
  
  # Verify binary exists
  if [[ -f "${pkgdir}/usr/bin/docura" ]]; then
    msg2 "Binary installed: /usr/bin/docura"
  else
    warning "Binary not found at /usr/bin/docura"
    msg2 "Searching for binary..."
    find "${pkgdir}" -type f -name "docura" 2>/dev/null || true
  fi
  
  # Clean up extracted .deb components
  cd "${srcdir}"
  rm -f control.tar.* data.tar.* debian-binary 2>/dev/null || true
}
